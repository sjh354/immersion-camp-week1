openapi: 3.0.3
info:
  title: 어디 (Eodi) API
  description: OpenAPI 문서 — `어디` 앱의 서버 API 스펙입니다. (자동 생성, 코드 기반)
  version: "1.0.0"
servers:
  - url: https://{BASE_URL}
    description: API 서버
    variables:
      BASE_URL:
        default: 172.10.5.116 (kcloudvpn)
paths:
  /api/auth/google:
    post:
      summary: Google ID 토큰으로 앱 토큰 발급
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthGoogleReq"
      responses:
        "200":
          description: 앱 토큰
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthGoogleRes"

  /api/categories:
    get:
      summary: 카테고리 목록 조회
      security:
        - bearerAuth: []
      responses:
        "200":
          description: 카테고리 목록
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CategoryListDto"

  /api/menus/{category}:
    get:
      summary: 특정 카테고리의 메뉴 목록 조회
      security:
        - bearerAuth: []
      parameters:
        - name: category
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 메뉴 목록
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MenuListDto"

    post:
      summary: 정렬/거리 정보를 포함한 메뉴 조회
      security:
        - bearerAuth: []
      parameters:
        - name: category
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/requestMenuListBySortingDto"
      responses:
        "200":
          description: 정렬된 메뉴 목록
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MenuListDto"

  /api/menus/favorite:
    post:
      summary: 메뉴 즐겨찾기 토글
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FavoriteRequestDto"
      responses:
        "200":
          description: 즐겨찾기 결과
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FavoriteResponseDto"

  /api/menus/favorites:
    get:
      summary: 사용자의 즐겨찾기 ID 목록 조회
      security:
        - bearerAuth: []
      responses:
        "200":
          description: 즐겨찾기 ID 목록
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FavoritesRes"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    AuthGoogleReq:
      type: object
      properties:
        id_token:
          type: string
      required: [id_token]

    AuthGoogleRes:
      type: object
      properties:
        app_token:
          type: string
      required: [app_token]

    CategoryListDto:
      type: object
      properties:
        data:
          type: array
          items:
            type: string
      example:
        data: ["치킨", "피자", "한식"]

    Menu:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        price:
          type: string
        img:
          type: string
          format: uri
        category:
          type: string
        store:
          type: string
        isFavorite:
          type: boolean
        starpoint:
          type: number
          format: float
        deeplink:
          type: string
      required:
        [id, name, price, img, category, store, isFavorite, starpoint, deeplink]

    MenuListDto:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/Menu"

    requestMenuListBySortingDto:
      type: object
      properties:
        sort:
          type: string
          description: 정렬 기준 (e.g., "starpoint", "price_asc", "price_desc", "distance")
        latitude:
          type: number
          format: double
        longitude:
          type: number
          format: double
      required: [sort, latitude, longitude]

    FavoriteRequestDto:
      type: object
      properties:
        id:
          type: integer
        changeto:
          type: boolean
      required: [id, changeto]

    FavoriteResponseDto:
      type: object
      properties:
        success:
          type: boolean
        id:
          type: integer
        isFavorite:
          type: boolean

    FavoritesRes:
      type: object
      properties:
        favorites:
          type: array
          items:
            type: integer
